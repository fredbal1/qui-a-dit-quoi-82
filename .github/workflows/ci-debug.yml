
name: CI Debug

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  debug-environment:
    runs-on: ubuntu-latest
    name: ğŸ› Debug Environment
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ” Debug package.json scripts
      run: |
        echo "ğŸ” VÃ©rification des scripts package.json..."
        cat package.json | grep -A 20 '"scripts"'
        
    - name: ğŸ”§ Install dependencies with debug
      run: |
        echo "ğŸ“¦ Installation des dÃ©pendances..."
        npm ci --verbose
        echo "âœ… Installation terminÃ©e"
        
    - name: ğŸ” List installed packages
      run: |
        echo "ğŸ“‹ Packages installÃ©s:"
        npm list --depth=0
        
    - name: ğŸ§ª Test basic commands
      run: |
        echo "ğŸ§ª Test des commandes de base..."
        echo "- Prettier:"
        npx prettier --version
        echo "- ESLint:"
        npx eslint --version
        echo "- Vitest:"
        npx vitest --version
        echo "- Playwright:"
        npx playwright --version
        
    - name: ğŸ“ Check file structure
      run: |
        echo "ğŸ“ Structure des fichiers critiques:"
        ls -la
        echo "ğŸ“ Contenu src/:"
        ls -la src/
        echo "ğŸ“ Contenu tests:"
        find . -name "*.test.*" -o -name "*.spec.*"

  minimal-tests:
    runs-on: ubuntu-latest
    name: ğŸ§ª Minimal Tests
    needs: debug-environment
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ”§ Install dependencies
      run: npm ci
        
    - name: ğŸ§ª Run unit tests only
      run: |
        echo "ğŸ§ª ExÃ©cution des tests unitaires uniquement..."
        npm run test -- --reporter=verbose
        
    - name: ğŸ—ï¸ Test build
      run: |
        echo "ğŸ—ï¸ Test de construction..."
        npm run build
